<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>federico-bot Architecture</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: linear-gradient(145deg, #0a0a1a 0%, #1a1a3e 50%, #0d1b2a 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      overflow: hidden;
    }
    
    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 16px 32px;
      background: rgba(10, 10, 26, 0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .header h1 {
      font-size: 1.2rem;
      font-weight: 700;
      color: #e0e0ff;
      letter-spacing: 0.5px;
    }
    
    .header .badge {
      font-size: 0.65rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 3px 10px;
      border-radius: 12px;
      font-weight: 600;
    }
    
    /* Canvas isomÃ©trico */
    .iso-viewport {
      position: absolute;
      top: 60px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: auto;
    }
    
    .iso-world {
      position: relative;
      min-width: 2000px;
      min-height: 1400px;
      /* TransformaciÃ³n isomÃ©trica real */
      transform-origin: center center;
    }
    
    /* Grid isomÃ©trico de fondo */
    .iso-grid {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }
    
    /* Grupos / Regiones */
    .iso-region {
      position: absolute;
      border-radius: 20px;
      border: 1.5px solid rgba(255,255,255,0.1);
      padding: 16px;
      transition: box-shadow 0.3s;
    }
    
    .iso-region:hover {
      box-shadow: 0 0 40px rgba(102, 126, 234, 0.15);
    }
    
    .iso-region-label {
      font-size: 0.6rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.4);
      margin-bottom: 8px;
    }
    
    /* Nodos isomÃ©tricos 3D */
    .iso-node {
      position: absolute;
      width: 130px;
      cursor: pointer;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), filter 0.3s;
      filter: drop-shadow(0 6px 20px rgba(0,0,0,0.4));
      z-index: 10;
    }
    
    .iso-node:hover {
      transform: translateY(-8px) scale(1.08);
      filter: drop-shadow(0 12px 35px rgba(102, 126, 234, 0.3));
      z-index: 20;
    }
    
    /* Cara superior del cubo isomÃ©trico */
    .iso-cube {
      position: relative;
      width: 130px;
      height: 100px;
      transform: rotateX(55deg) rotateZ(-45deg);
      transform-style: preserve-3d;
    }
    
    /* VersiÃ³n simplificada: tarjeta con perspectiva isomÃ©trica */
    .iso-card {
      position: relative;
      width: 130px;
      background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 14px;
      padding: 14px 10px;
      text-align: center;
      backdrop-filter: blur(10px);
      transform: perspective(800px) rotateX(10deg) rotateY(-5deg);
      transition: transform 0.3s;
    }
    
    .iso-node:hover .iso-card {
      transform: perspective(800px) rotateX(5deg) rotateY(-2deg);
    }
    
    .iso-card::before {
      content: '';
      position: absolute;
      top: -1px; left: -1px; right: -1px; bottom: -1px;
      border-radius: 14px;
      padding: 1px;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent, rgba(255,255,255,0.1));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }
    
    /* Acento de color en la parte superior */
    .iso-card .color-bar {
      position: absolute;
      top: 0;
      left: 12px;
      right: 12px;
      height: 3px;
      border-radius: 0 0 4px 4px;
    }
    
    .iso-card .icon {
      font-size: 2rem;
      margin-bottom: 6px;
      display: block;
    }
    
    .iso-card .label {
      font-size: 0.72rem;
      font-weight: 700;
      color: #e0e0ff;
      line-height: 1.3;
      margin-bottom: 3px;
    }
    
    .iso-card .desc {
      font-size: 0.58rem;
      color: rgba(255,255,255,0.45);
      line-height: 1.3;
    }
    
    .iso-card .type-pill {
      display: inline-block;
      font-size: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 2px 8px;
      border-radius: 6px;
      margin-top: 6px;
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.5);
    }
    
    /* Tooltip */
    .iso-tooltip {
      display: none;
      position: absolute;
      bottom: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 10, 30, 0.95);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 10px 14px;
      min-width: 180px;
      z-index: 50;
      backdrop-filter: blur(20px);
    }
    
    .iso-node:hover .iso-tooltip {
      display: block;
    }
    
    .iso-tooltip .tt-title {
      font-size: 0.75rem;
      font-weight: 700;
      color: #e0e0ff;
      margin-bottom: 4px;
    }
    
    .iso-tooltip .tt-desc {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
    }
    
    /* SVG Edges */
    svg.edge-layer {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 5;
    }
    
    .edge-label {
      font-size: 9px;
      fill: rgba(255,255,255,0.5);
      font-family: 'Segoe UI', sans-serif;
      font-weight: 600;
    }
    
    .edge-label-bg {
      fill: rgba(10, 10, 26, 0.8);
      rx: 4;
    }
    
    /* Metadata footer */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px 32px;
      background: rgba(10, 10, 26, 0.7);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.6rem;
      color: rgba(255,255,255,0.25);
      z-index: 100;
    }
    
    .footer .stats span {
      margin-right: 16px;
    }
    
    /* AnimaciÃ³n de entrada */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .iso-node {
      animation: fadeInUp 0.6s ease-out backwards;
    }
    
    /* Glow animado para edges */
    @keyframes edgePulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }
    
    .edge-animated {
      animation: edgePulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>federico-bot Architecture</h1>
    <span class="badge">ISOMETRIC</span>
    <span class="badge" style="background: linear-gradient(135deg, #f093fb, #f5576c);">AI Generated</span>
  </div>

  <!-- Viewport -->
  <div class="iso-viewport">
    <div class="iso-world" id="world">
      <div class="iso-grid"></div>
      <!-- Nodes y edges se renderizan via JS -->
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="stats">
      <span>ðŸ“¦ 6 components</span>
      <span>ðŸ”— 6 connections</span>
      <span>ðŸ“‚ 5 layers</span>
    </div>
    <div>
      Generated by Orion AI â€¢ 2026-02-07T20:08:18.855Z â€¢ Powered by Isoflow
    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•
    const model = {"name":"federico-bot Architecture","description":"Isometric architecture diagram for TypeScript React bot application","groups":[{"id":"external","label":"External Layer","style":{"color":"#e3f2fd","opacity":0.3}},{"id":"frontend","label":"Frontend","style":{"color":"#e8eaf6","opacity":0.3}},{"id":"backend","label":"Backend Services","style":{"color":"#f3e5f5","opacity":0.3}},{"id":"data","label":"Data Layer","style":{"color":"#e8f5e9","opacity":0.3}},{"id":"infra","label":"Infrastructure","style":{"color":"#fff3e0","opacity":0.3}}],"nodes":[{"id":"users","type":"person","label":"Bot Users","description":"End users interacting with Federico Bot","group":"external","icon":"person","position":{"x":0,"y":0},"style":{"color":"#1976d2"}},{"id":"react_frontend","type":"browser","label":"React Frontend","description":"TypeScript React UI with custom hooks","group":"frontend","icon":"browser","position":{"x":1,"y":0},"style":{"color":"#673ab7"}},{"id":"nodejs_backend","type":"server","label":"Node.js Backend","description":"TypeScript Node.js bot service","group":"backend","icon":"server","position":{"x":2,"y":0},"style":{"color":"#7b1fa2"}},{"id":"bot_engine","type":"microservice","label":"Bot Engine","description":"Core bot logic and conversation handling","group":"backend","icon":"microservice","position":{"x":2,"y":1},"style":{"color":"#8e24aa"}},{"id":"external_api","type":"cloud","label":"External APIs","description":"Third-party services integration","group":"external","icon":"cloud","position":{"x":3,"y":0},"style":{"color":"#1976d2"}},{"id":"local_storage","type":"storage","label":"Local Storage","description":"Bot state and conversation data","group":"data","icon":"storage","position":{"x":3,"y":1},"style":{"color":"#388e3c"}}],"edges":[{"from":"users","to":"react_frontend","label":"User Interactions","style":{"color":"#1976d2","animated":true}},{"from":"react_frontend","to":"nodejs_backend","label":"API Requests","style":{"color":"#673ab7"}},{"from":"nodejs_backend","to":"bot_engine","label":"Bot Commands","style":{"color":"#7b1fa2"}},{"from":"bot_engine","to":"external_api","label":"Service Calls","style":{"color":"#8e24aa"}},{"from":"bot_engine","to":"local_storage","label":"Data Persistence","style":{"color":"#388e3c"}},{"from":"nodejs_backend","to":"react_frontend","label":"Bot Responses","style":{"color":"#7b1fa2"}}],"metadata":{"generatedAt":"2026-02-07T20:08:18.855Z","projectType":"code","version":"1.0.0"}};
    
    const ICONS = {"person":{"emoji":"ðŸ‘¤","color":"#1976d2"},"browser":{"emoji":"ðŸ–¥ï¸","color":"#5c6bc0"},"server":{"emoji":"âš™ï¸","color":"#7b1fa2"},"database":{"emoji":"ðŸ—„ï¸","color":"#388e3c"},"cloud":{"emoji":"â˜ï¸","color":"#0277bd"},"queue":{"emoji":"ðŸ“¨","color":"#f57c00"},"lock":{"emoji":"ðŸ”","color":"#c62828"},"cache":{"emoji":"âš¡","color":"#f9a825"},"lambda":{"emoji":"Î»","color":"#ff6f00"},"cdn":{"emoji":"ðŸŒ","color":"#00838f"},"loadbalancer":{"emoji":"âš–ï¸","color":"#4527a0"},"firewall":{"emoji":"ðŸ›¡ï¸","color":"#bf360c"},"storage":{"emoji":"ðŸ’¾","color":"#2e7d32"},"microservice":{"emoji":"ðŸ”·","color":"#283593"},"container":{"emoji":"ðŸ“¦","color":"#4e342e"}};
    
    const GRID_X = 200;  // Espacio horizontal entre nodos
    const GRID_Y = 180;  // Espacio vertical entre nodos
    const OFFSET_X = 300; // Offset inicial X
    const OFFSET_Y = 200; // Offset inicial Y
    
    const world = document.getElementById('world');
    
    // â•â•â•â•â•â•â• RENDER REGIONS (Groups) â•â•â•â•â•â•â•
    if (model.groups && model.groups.length > 0) {
      // Calcular bounds por grupo
      const groupBounds = {};
      model.groups.forEach(g => {
        groupBounds[g.id] = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };
      });
      
      model.nodes.forEach(node => {
        if (node.group && groupBounds[node.group]) {
          const px = (node.position?.x || 0) * GRID_X + OFFSET_X;
          const py = (node.position?.y || 0) * GRID_Y + OFFSET_Y;
          const b = groupBounds[node.group];
          b.minX = Math.min(b.minX, px);
          b.minY = Math.min(b.minY, py);
          b.maxX = Math.max(b.maxX, px + 130);
          b.maxY = Math.max(b.maxY, py + 140);
        }
      });
      
      model.groups.forEach(group => {
        const b = groupBounds[group.id];
        if (b.minX === Infinity) return; // No nodes in group
        
        const padding = 30;
        const el = document.createElement('div');
        el.className = 'iso-region';
        el.style.left = (b.minX - padding) + 'px';
        el.style.top = (b.minY - padding - 20) + 'px';
        el.style.width = (b.maxX - b.minX + padding * 2) + 'px';
        el.style.height = (b.maxY - b.minY + padding * 2 + 20) + 'px';
        el.style.background = (group.style?.color || 'rgba(255,255,255,0.03)');
        el.style.opacity = '0.15';
        
        const label = document.createElement('div');
        label.className = 'iso-region-label';
        label.textContent = group.label;
        el.appendChild(label);
        
        world.appendChild(el);
      });
    }
    
    // â•â•â•â•â•â•â• RENDER NODES â•â•â•â•â•â•â•
    const nodePositions = {};
    
    model.nodes.forEach((node, index) => {
      const x = (node.position?.x || 0) * GRID_X + OFFSET_X;
      const y = (node.position?.y || 0) * GRID_Y + OFFSET_Y;
      
      const iconDef = ICONS[node.icon] || ICONS[node.type] || { emoji: 'ðŸ“¦', color: '#667eea' };
      const nodeColor = node.style?.color || iconDef.color;
      
      const el = document.createElement('div');
      el.className = 'iso-node';
      el.id = 'node-' + node.id;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      el.style.animationDelay = (index * 0.1) + 's';
      
      el.innerHTML = `
        <div class="iso-card">
          <div class="color-bar" style="background: linear-gradient(90deg, ${nodeColor}, ${nodeColor}88);"></div>
          <span class="icon">${iconDef.emoji}</span>
          <div class="label">${node.label}</div>
          ${node.description ? '<div class="desc">' + node.description + '</div>' : ''}
          <div class="type-pill" style="color: ${nodeColor}; border: 1px solid ${nodeColor}33;">${node.type}</div>
        </div>
        <div class="iso-tooltip">
          <div class="tt-title">${node.label}</div>
          <div class="tt-desc">${node.description || node.type}</div>
        </div>
      `;
      
      world.appendChild(el);
      
      // Guardar posiciÃ³n central para edges
      nodePositions[node.id] = {
        x: x + 65,  // centro del nodo
        y: y + 60
      };
    });
    
    // â•â•â•â•â•â•â• RENDER EDGES (SVG) â•â•â•â•â•â•â•
    requestAnimationFrame(() => {
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.classList.add('edge-layer');
      svg.setAttribute('width', '100%');
      svg.setAttribute('height', '100%');
      svg.style.width = world.scrollWidth + 'px';
      svg.style.height = world.scrollHeight + 'px';
      
      // Defs: markers y filtros
      const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
      
      // Arrowhead marker
      const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
      marker.setAttribute('id', 'arrow');
      marker.setAttribute('markerWidth', '8');
      marker.setAttribute('markerHeight', '6');
      marker.setAttribute('refX', '8');
      marker.setAttribute('refY', '3');
      marker.setAttribute('orient', 'auto');
      const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      arrowPath.setAttribute('d', 'M0,0 L8,3 L0,6 L2,3 Z');
      arrowPath.setAttribute('fill', 'rgba(255,255,255,0.4)');
      marker.appendChild(arrowPath);
      defs.appendChild(marker);
      
      // Glow filter
      const filter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
      filter.setAttribute('id', 'glow');
      const blur = document.createElementNS('http://www.w3.org/2000/svg', 'feGaussianBlur');
      blur.setAttribute('stdDeviation', '2');
      blur.setAttribute('result', 'glow');
      filter.appendChild(blur);
      const merge = document.createElementNS('http://www.w3.org/2000/svg', 'feMerge');
      const mergeNode1 = document.createElementNS('http://www.w3.org/2000/svg', 'feMergeNode');
      mergeNode1.setAttribute('in', 'glow');
      merge.appendChild(mergeNode1);
      const mergeNode2 = document.createElementNS('http://www.w3.org/2000/svg', 'feMergeNode');
      mergeNode2.setAttribute('in', 'SourceGraphic');
      merge.appendChild(mergeNode2);
      filter.appendChild(merge);
      defs.appendChild(filter);
      
      svg.appendChild(defs);
      
      // Render cada edge como curva bezier
      model.edges.forEach(edge => {
        const fromPos = nodePositions[edge.from];
        const toPos = nodePositions[edge.to];
        if (!fromPos || !toPos) return;
        
        const edgeColor = edge.style?.color || 'rgba(255,255,255,0.3)';
        const isAnimated = edge.style?.animated || false;
        
        // Calcular control points para curva suave
        const dx = toPos.x - fromPos.x;
        const dy = toPos.y - fromPos.y;
        const cx1 = fromPos.x + dx * 0.4;
        const cy1 = fromPos.y;
        const cx2 = toPos.x - dx * 0.4;
        const cy2 = toPos.y;
        
        // Path curvo
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M ${fromPos.x} ${fromPos.y} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${toPos.x} ${toPos.y}`);
        path.setAttribute('stroke', edgeColor);
        path.setAttribute('stroke-width', '2');
        path.setAttribute('fill', 'none');
        path.setAttribute('marker-end', 'url(#arrow)');
        path.setAttribute('filter', 'url(#glow)');
        
        if (edge.style?.strokeDash) {
          path.setAttribute('stroke-dasharray', edge.style.strokeDash);
        }
        
        if (isAnimated) {
          path.classList.add('edge-animated');
        }
        
        svg.appendChild(path);
        
        // Label del edge
        if (edge.label) {
          const midX = (fromPos.x + toPos.x) / 2;
          const midY = (fromPos.y + toPos.y) / 2 - 12;
          
          // Background del label
          const labelBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          const labelWidth = edge.label.length * 5.5 + 12;
          labelBg.setAttribute('x', String(midX - labelWidth / 2));
          labelBg.setAttribute('y', String(midY - 8));
          labelBg.setAttribute('width', String(labelWidth));
          labelBg.setAttribute('height', '16');
          labelBg.classList.add('edge-label-bg');
          svg.appendChild(labelBg);
          
          // Texto del label
          const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('x', String(midX));
          text.setAttribute('y', String(midY + 3));
          text.setAttribute('text-anchor', 'middle');
          text.classList.add('edge-label');
          text.textContent = edge.label;
          svg.appendChild(text);
        }
      });
      
      world.insertBefore(svg, world.firstChild?.nextSibling || null);
      
      // SeÃ±al de render completo para Puppeteer
      const signal = document.createElement('div');
      signal.id = 'iso-render-complete';
      signal.style.display = 'none';
      document.body.appendChild(signal);
    });
  </script>
</body>
</html>